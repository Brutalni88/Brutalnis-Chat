<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Void Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <style>
        body { background-color: #000; color: white; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        
        /* Layout */
        #user-list { width: 20%; border-right: 1px solid #333; padding: 20px; background: #0a0a0a; }
        #chat-area { flex: 1; display: flex; flex-direction: column; background: #111; }
        #messages { flex: 1; padding: 20px; overflow-y: auto; color: #ddd; }
        #input-area { padding: 20px; border-top: 1px solid #333; background: #0a0a0a; display: flex; }
        
        /* UI Elements */
        input { background: #1a1a1a; border: 1px solid #333; color: white; padding: 12px; flex: 1; border-radius: 5px; outline: none; }
        #settings { width: 20%; border-left: 1px solid #333; padding: 20px; background: #0a0a0a; }
        .admin-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; }
        
        /* Messages */
        .msg { margin-bottom: 12px; line-height: 1.4; }
        .msg b { color: #888; margin-right: 8px; }
        img { max-width: 100%; border-radius: 8px; margin: 10px 0; border: 1px solid #444; }
        .sys { color: #ff4444; font-weight: bold; }
    </style>
</head>
<body>

    <div id="user-list">
        <h3 style="color:#555; font-size:0.8em;">ONLINE</h3>
        <ul id="users" style="list-style:none; padding:0;"><li>Unnamed (You)</li></ul>
    </div>

    <div id="chat-area">
        <div id="messages"></div>
        <div id="input-area">
            <input type="text" id="msgInput" placeholder="Type a message or image URL...">
        </div>
    </div>

    <div id="settings">
        <h3 style="color:#555; font-size:0.8em;">SETTINGS</h3>
        <label>Your Name:</label><br>
        <input type="text" id="nameInput" placeholder="Unnamed" maxlength="12" oninput="updateName()"><br><br>
        
        <div class="admin-section">
            <label>Admin Key:</label><br>
            <input type="password" id="adminKey" placeholder="••••••••">
        </div>
    </div>

    <script>
        // Connect to the network
        const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
        const chat = gun.get('brutalnis-void-v2'); // New room name for fresh start

        const msgInput = document.getElementById('msgInput');
        const nameInput = document.getElementById('nameInput');
        const messagesDiv = document.getElementById('messages');
        const adminKey = document.getElementById('adminKey');
        const ADMIN_PASS = "ACC19240ADMIN05143";

        // --- SENDING ---
        msgInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                let val = msgInput.value.trim();
                let username = nameInput.value || "Unnamed";
                if (!val) return;

                // Admin Logic
                if (val.startsWith('/timeout ')) {
                    if (adminKey.value === ADMIN_PASS) {
                        let target = val.replace('/timeout ', '').replace('@', '');
                        chat.get('system').put({ type: 'timeout', target: target, time: Date.now() });
                    } else {
                        addMessage("SYSTEM", "Wrong Admin Key geg.", "red");
                    }
                } 
                else {
                    let type = val.match(/\.(jpeg|jpg|gif|png|webp)$/i) ? 'img' : 'text';
                    chat.set({ name: username, text: val, type: type, time: Date.now() });
                }
                msgInput.value = '';
            }
        });

        // --- RECEIVING ---
        chat.map().once((data) => {
            if (!data || !data.name) return;

            // 24 Hour Purge Logic
            const dayAgo = Date.now() - (24 * 60 * 60 * 1000);
            if (data.time < dayAgo) return;

            addMessage(data.name, data.text, data.type === 'img' ? 'img' : 'white');
        });

        // System Listeners
        chat.get('system').on((data) => {
            if (data.type === 'timeout') {
                addMessage("SYSTEM", `${data.target} has been timed out.`, "red");
            }
        });

        function addMessage(user, text, mode) {
            let div = document.createElement('div');
            div.className = "msg";
            if (mode === 'img') {
                div.innerHTML = `<b>${user}:</b><br><img src="${text}">`;
            } else {
                div.innerHTML = `<b style="${user === 'SYSTEM' ? 'color:red' : ''}">${user}:</b> <span style="color:${mode}">${text}</span>`;
            }
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function updateName() {
            document.querySelector('#users li').innerText = (nameInput.value || "Unnamed") + " (You)";
        }
    </script>
</body>
</html>
