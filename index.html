<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Void Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <style>
        body { background-color: #000; color: white; font-family: sans-serif; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        #chat-area { flex: 1; display: flex; flex-direction: column; background: #050505; }
        #messages { flex: 1; padding: 20px; overflow-y: auto; }
        #input-area { padding: 20px; border-top: 1px solid #222; display: flex; background: #000; }
        input { background: #111; border: 1px solid #333; color: white; padding: 15px; flex: 1; outline: none; border-radius: 5px; }
        #status-dot { position: fixed; top: 15px; right: 15px; width: 12px; height: 12px; background: red; border-radius: 50%; box-shadow: 0 0 10px red; }
        .msg { margin-bottom: 10px; border-left: 2px solid #222; padding-left: 10px; }
        b { color: #666; font-size: 0.8em; text-transform: uppercase; }
        img { max-width: 300px; border-radius: 10px; margin-top: 5px; border: 1px solid #333; }
    </style>
</head>
<body>

    <div id="status-dot" title="Connection Status"></div>

    <div id="chat-area">
        <div id="messages"></div>
        <div id="input-area">
            <input type="text" id="msgInput" placeholder="Send a message or image link..." autocomplete="off">
        </div>
    </div>

    <script>
        // Using multiple backup relays so it doesn't fail lol
        const gun = Gun([
            'https://gun-manhattan.herokuapp.com/gun',
            'https://p2p-relay.herokuapp.com/gun'
        ]);
        
        // Use a unique room name for your chat
        const chat = gun.get('brutalnis-void-final-99');

        const msgInput = document.getElementById('msgInput');
        const messagesDiv = document.getElementById('messages');
        const statusDot = document.getElementById('status-dot');

        // Check if we are connected to the relay geg
        gun.on('hi', () => { 
            statusDot.style.background = 'lime'; 
            statusDot.style.boxShadow = '0 0 10px lime';
        });

        // --- SENDING ---
        msgInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                let val = msgInput.value.trim();
                if (!val) return;

                let type = val.match(/\.(jpeg|jpg|gif|png|webp)$/i) ? 'img' : 'text';
                
                // Put msg into the decentralized graph
                chat.set({ name: 'User', text: val, type: type, time: Date.now() });
                msgInput.value = '';
            }
        });

        // --- RECEIVING ---
        chat.map().once((data, id) => {
            if (!data || !data.text) return;

            // Simple 24h Purge: Don't show old stuff lol
            if (Date.now() - data.time > 86400000) return;

            let div = document.createElement('div');
            div.className = "msg";
            
            if (data.type === 'img') {
                div.innerHTML = `<b>${data.name}</b><br><img src="${data.text}">`;
            } else {
                div.innerHTML = `<b>${data.name}</b><br><span>${data.text}</span>`;
            }

            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    </script>
</body>
</html>
